<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –º–∏—Ä?</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <h1>üåç –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –º–∏—Ä?</h1>

    <div class="roles">
        {% set role_labels = {
            "academic": "üî¨ –û–ø—ã—Ç–Ω—ã–π —É—á—ë–Ω—ã–π",
            "phd": "üß™ –ú–æ–ª–æ–¥–æ–π —É—á—ë–Ω—ã–π",
            "student": "üìö –°—Ç–∞—Ä—à–µ–∫–ª–∞—Å—Å–Ω–∏–∫",
            "peer": "üßë‚Äçüéì –®–∫–æ–ª—å–Ω–∏–∫"
        } %}
        {% for key, label in role_labels.items() %}
            <label class="role-btn {% if style == key %}selected{% endif %}">
                {{ label }}
                <input type="radio" name="style" value="{{ key }}" {% if style == key %}checked{% endif %} hidden>
            </label>
        {% endfor %}
    </div>

    <form id="questionForm" method="post">
        <textarea name="question" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º–∏—Ä–µ...">{{ question }}</textarea><br>

        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∏–ª—è -->
        <input type="hidden" id="style_input" name="style" value="{{ style }}">

        <button type="submit">‚ùì –°–ø—Ä–æ—Å–∏—Ç—å</button>
    </form>

    <div class="status" id="statusBox">
        {% if status %}
            {% if status == "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç–≤–µ—Ç..." %}
                <span class="loader"></span>
            {% endif %}
            {{ status }}
        {% endif %}
    </div>

    {% if html_answer %}
        <div class="output-box">{{ html_answer | safe }}</div>
    {% endif %}

    <div class="history-toggle" onclick="toggleHistory()">üìú –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤</div>

    <div id="historyBox" style="display: none;">
        {% if history %}
            <table>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–í–æ–ø—Ä–æ—Å</th>
                    <th>–†–æ–ª—å</th>
                    <th>–û—Ç–≤–µ—Ç</th>
                </tr>
                {% for entry in history %}
                    <tr>
                        <td>{{ entry.timestamp }}</td>
                        <td>{{ entry.question }}</td>
                        <td>{{ role_labels.get(entry.style, entry.style) }}</td>
                        <td>{{ entry.html_answer | safe }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞.</p>
        {% endif %}
    </div>

    <script>
        function toggleHistory() {
            const box = document.getElementById("historyBox");
            box.style.display = box.style.display === "none" ? "block" : "none";
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º hidden input –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–æ–ª–∏
        document.querySelectorAll(".role-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö
                document.querySelectorAll(".role-btn").forEach(b => b.classList.remove("selected"));
                btn.classList.add("selected");

                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∏–ª—å –∏ –æ–±–Ω–æ–≤–ª—è–µ–º hidden input
                const styleValue = btn.querySelector("input[type='radio']").value;
                document.getElementById("style_input").value = styleValue;
            });
        });
    </script>

    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏
        document.querySelectorAll(".role-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelectorAll(".role-btn").forEach(b => b.classList.remove("selected"));
                btn.classList.add("selected");
                const styleValue = btn.querySelector("input[type='radio']").value;
                document.getElementById("style_input").value = styleValue;
            });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById("questionForm").addEventListener("submit", function () {
            const statusBox = document.getElementById("statusBox");
            statusBox.innerHTML = '<span class="loader"></span> –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç–≤–µ—Ç...';
            statusBox.style.display = 'block';
        });

        // –ü–æ–∫–∞–∑ –∏—Å—Ç–æ—Ä–∏–∏
        function toggleHistory() {
            const box = document.getElementById("historyBox");
            box.style.display = box.style.display === "none" ? "block" : "none";
        }
    </script>

</body>
</html>